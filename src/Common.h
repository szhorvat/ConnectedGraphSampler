#ifndef CDS_COMMON_H
#define CDS_COMMON_H

#include <vector>
#include <cmath>

#ifndef Assert
#include <cassert>
#define Assert assert
#endif

namespace CDS {

typedef int deg_t;

typedef std::pair<int, int> edge;
typedef std::vector<edge> edgelist_t;

typedef std::vector<char> bitmask_t;


template<typename T>
T sqr(const T &x) { return x*x; }


// Compute the logarithm of n-factorial.
// Based on: https://www.johndcook.com/blog/2010/08/16/how-to-compute-log-factorial/
inline double logfact(int n) {
    const double lf[] = {
                    0.0,
                    0.0,
                    0.6931471805599453,
                    1.791759469228055,
                    3.1780538303479458,
                    4.787491742782046,
                    6.579251212010101,
                    8.525161361065415,
                    1.060460290274525e1,
                    1.2801827480081469e1,
                    1.5104412573075516e1,
                    1.7502307845873887e1,
                    1.9987214495661885e1,
                    2.2552163853123425e1,
                    2.519122118273868e1,
                    2.789927138384089e1,
                    3.0671860106080672e1,
                    3.350507345013689e1,
                    3.639544520803305e1,
                    3.9339884187199495e1,
                    4.2335616460753485e1,
                    4.538013889847691e1,
                    4.847118135183523e1,
                    5.160667556776438e1,
                    5.478472939811232e1,
                    5.800360522298052e1,
                    6.1261701761002e1,
                    6.455753862700634e1,
                    6.788974313718154e1,
                    7.125703896716801e1,
                    7.465823634883016e1,
                    7.80922235533153e1,
                    8.155795945611504e1,
                    8.505446701758152e1,
                    8.858082754219768e1,
                    9.21361756036871e1,
                    9.57196945421432e1,
                    9.933061245478743e1,
                    1.0296819861451381e2,
                    1.0663176026064346e2,
                    1.1032063971475739e2,
                    1.140342117814617e2,
                    1.1777188139974507e2,
                    1.2153308151543864e2,
                    1.253172711493569e2,
                    1.2912393363912722e2,
                    1.3295257503561632e2,
                    1.3680272263732635e2,
                    1.4067392364823425e2,
                    1.445657439463449e2,
                    1.4847776695177302e2,
                    1.5240959258449735e2,
                    1.563608363030788e2,
                    1.603311282166309e2,
                    1.6432011226319517e2,
                    1.6832744544842765e2,
                    1.723527971391628e2,
                    1.7639584840699735e2,
                    1.8045629141754378e2,
                    1.8453382886144948e2,
                    1.886281734236716e2,
                    1.927390472878449e2,
                    1.9686618167289e2,
                    2.0100931639928152e2,
                    2.051681994826412e2,
                    2.0934258675253685e2,
                    2.1353224149456327e2,
                    2.1773693411395422e2,
                    2.2195644181913033e2,
                    2.261905483237276e2,
                    2.3043904356577696e2,
                    2.3470172344281826e2,
                    2.3897838956183432e2,
                    2.432688490029827e2,
                    2.4757291409618688e2,
                    2.518904022097232e2,
                    2.5622113555000954e2,
                    2.605649409718632e2,
                    2.649216497985528e2,
                    2.692910976510198e2,
                    2.736731242856937e2,
                    2.780675734403661e2,
                    2.824742926876304e2,
                    2.86893133295427e2,
                    2.913239500942703e2,
                    2.9576660135076065e2,
                    3.0022094864701415e2,
                    3.046868567656687e2,
                    3.091641935801469e2,
                    3.1365282994987905e2,
                    3.181526396202093e2,
                    3.2266349912672615e2,
                    3.271852877037752e2,
                    3.317178871969285e2,
                    3.3626118197919845e2,
                    3.40815058870799e2,
                    3.4537940706226686e2,
                    3.4995411804077025e2,
                    3.545390855194408e2,
                    3.591342053695754e2,
                    3.6373937555556347e2,
                    3.6835449607240474e2,
                    3.72979468885689e2,
                    3.7761419787391867e2,
                    3.8225858877306e2,
                    3.8691254912321756e2,
                    3.915759882173296e2,
                    3.9624881705179155e2,
                    4.0093094827891576e2,
                    4.056222961611449e2,
                    4.1032277652693733e2,
                    4.1503230672824964e2,
                    4.197508055995447e2,
                    4.244781934182571e2,
                    4.2921439186665157e2,
                    4.339593239950148e2,
                    4.3871291418612117e2,
                    4.4347508812091894e2,
                    4.482457727453846e2,
                    4.530248962384961e2,
                    4.5781238798127816e2,
                    4.626081785268749e2,
                    4.674121995716082e2,
                    4.722243839269806e2,
                    4.7704466549258564e2,
                    4.8187297922988796e2,
                    4.867092611368394e2,
                    4.91553448223298e2,
                    4.9640547848721764e2,
                    5.012652908915793e2,
                    5.061328253420349e2,
                    5.11008022665236e2,
                    5.158908245878224e2,
                    5.207811737160441e2,
                    5.25679013515995e2,
                    5.305842882944335e2,
                    5.354969431801695e2,
                    5.404169241059976e2,
                    5.453441777911548e2,
                    5.502786517242855e2,
                    5.552202941468948e2,
                    5.60169054037273e2,
                    5.651248810948744e2,
                    5.700877257251342e2,
                    5.750575390247102e2,
                    5.800342727671308e2,
                    5.850178793888391e2,
                    5.900083119756179e2,
                    5.95005524249382e2,
                    6.000094705553274e2,
                    6.050201058494237e2,
                    6.100373856862386e2,
                    6.150612662070849e2,
                    6.200917041284773e2,
                    6.25128656730891e2,
                    6.301720818478102e2,
                    6.352219378550598e2,
                    6.40278183660408e2,
                    6.45340778693435e2,
                    6.504096828956552e2,
                    6.554848567108891e2,
                    6.605662610758735e2,
                    6.65653857411106e2,
                    6.707476076119127e2,
                    6.758474740397369e2,
                    6.809534195136374e2,
                    6.86065407301994e2,
                    6.911834011144108e2,
                    6.96307365093814e2,
                    7.01437263808737e2,
                    7.065730622457874e2,
                    7.1171472580229e2,
                    7.168622202791034e2,
                    7.220155118736012e2,
                    7.271745671728157e2,
                    7.323393531467393e2,
                    7.375098371417774e2,
                    7.426859868743512e2,
                    7.478677704246434e2,
                    7.530551562304842e2,
                    7.582481130813743e2,
                    7.634466101126401e2,
                    7.686506167997169e2,
                    7.738601029525583e2,
                    7.790750387101673e2,
                    7.842953945352457e2,
                    7.895211412089589e2,
                    7.947522498258135e2,
                    7.999886917886435e2,
                    8.05230438803703e2,
                    8.104774628758636e2,
                    8.157297363039102e2,
                    8.209872316759379e2,
                    8.262499218648428e2,
                    8.315177800239062e2,
                    8.367907795824699e2,
                    8.420688942417004e2,
                    8.473520979704384e2,
                    8.52640365001133e2,
                    8.579336698258575e2,
                    8.632319871924054e2,
                    8.685352921004645e2,
                    8.738435597978657e2,
                    8.791567657769075e2,
                    8.844748857707517e2,
                    8.897978957498901e2,
                    8.951257719186798e2,
                    9.004584907119452e2,
                    9.057960287916464e2,
                    9.111383630436112e2,
                    9.164854705743287e2,
                    9.218373287078048e2,
                    9.271939149824768e2,
                    9.325552071481862e2,
                    9.379211831632081e2,
                    9.432918211913358e2,
                    9.486670995990199e2,
                    9.540469969525603e2,
                    9.594314920153495e2,
                    9.648205637451659e2,
                    9.702141912915183e2,
                    9.756123539930361e2,
                    9.810150313749083e2,
                    9.864222031463685e2,
                    9.918338491982234e2,
                    9.97249949600428e2,
                    1.0026704845997002e3,
                    1.0080954346171816e3,
                    1.0135247802461361e3,
                    1.0189585022496902e3,
                    1.0243965815586134e3,
                    1.0298389992691352e3,
                    1.0352857366408016e3,
                    1.0407367750943672e3,
                    1.046192096209725e3,
                    1.0516516817238692e3,
                    1.0571155135288948e3,
                    1.0625835736700299e3,
                    1.0680558443437014e3,
                    1.0735323078956328e3,
                    1.0790129468189748e3,
                    1.0844977437524656e3,
                    1.0899866814786221e3,
                    1.0954797429219627e3,
                    1.100976911147256e3,
                    1.1064781693578007e3,
                    1.111983500893733e3,
                    1.117492889230361e3,
                    1.123006317976526e3,
                    1.1285237708729908e3,
                    1.134045231790853e3,
                    1.1395706847299848e3,
                    1.145100113817496e3,
                    1.1506335033062237e3,
                    1.1561708375732421e3,
                    1.1617121011184006e3,
                    1.1672572785628802e3
    };

    if (n <= 256) {
        return lf[n];
    } else {
        double x = n+1;
        return (x - 0.5) * std::log(x) - x + 0.5 * std::log(2*M_PI) + 1/(12*x);
    }
}

} // namespace CDS

#endif // CDS_COMMON_H
